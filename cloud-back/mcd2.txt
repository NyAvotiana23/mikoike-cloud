# ğŸ“Š MCD - DIAGRAMME TEXTE COMPLET DES TABLES

## Vue d'ensemble des relations

```
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚      USER       â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚                    â”‚                        â”‚
        â”‚                    â”‚                        â”‚
        â–¼                    â–¼                        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    SESSION    â”‚    â”‚ SIGNALEMENT  â”‚       â”‚ FAILED_LOGIN_   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚   TRACKING      â”‚
                            â”‚                â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
                            â”‚
                            â–¼
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚  HISTORIQUE_     â”‚
                    â”‚     STATUS       â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ LOGIN_ATTEMPT   â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’ USER (N:1)
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   SYNC_QUEUE    â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’ USER (N:1)
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  SYNC_HISTORY   â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’ USER (N:1)
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’ SYNC_QUEUE (N:1)
         â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’ USER (N:1)
```

---

## 1ï¸âƒ£ TABLE : USER

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                           USER                               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ğŸ”‘ id                     BIGINT           [PK]              â”‚
â”‚ âš¡ email                  VARCHAR(255)     [UNIQUE, NOT NULL]â”‚
â”‚    password_hash          VARCHAR(255)     [NOT NULL]        â”‚
â”‚    name                   VARCHAR(100)     [NOT NULL]        â”‚
â”‚                                                               â”‚
â”‚ ğŸ”¥ firebase_uid           VARCHAR(128)     [UNIQUE]          â”‚
â”‚    firebase_synced        BOOLEAN          [DEFAULT FALSE]   â”‚
â”‚    firebase_sync_error    TEXT                               â”‚
â”‚    synced_at              TIMESTAMP                          â”‚
â”‚                                                               â”‚
â”‚    role                   VARCHAR(20)      [NOT NULL]        â”‚
â”‚                           â€¢ VISITEUR                         â”‚
â”‚                           â€¢ UTILISATEUR                      â”‚
â”‚                           â€¢ MANAGER                          â”‚
â”‚                                                               â”‚
â”‚ ğŸ”’ is_locked              BOOLEAN          [DEFAULT FALSE]   â”‚
â”‚    locked_until           TIMESTAMP                          â”‚
â”‚    failed_attempts        INT              [DEFAULT 0]       â”‚
â”‚    last_failed_attempt_at TIMESTAMP                          â”‚
â”‚                                                               â”‚
â”‚ ğŸ”— created_by             BIGINT           [FK â†’ USER.id]    â”‚
â”‚ ğŸ“… created_at             TIMESTAMP        [DEFAULT NOW()]   â”‚
â”‚    updated_at             TIMESTAMP        [DEFAULT NOW()]   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Contraintes :
- CHECK: role IN ('VISITEUR', 'UTILISATEUR', 'MANAGER')
- CHECK: Si firebase_synced=TRUE alors firebase_uid NOT NULL

Relations :
- USER (1) â”€â”€crÃ©eâ”€â”€â†’ (N) USER [self-reference via created_by]
- USER (1) â”€â”€possÃ¨deâ”€â”€â†’ (N) SESSION
- USER (1) â”€â”€crÃ©eâ”€â”€â†’ (N) SIGNALEMENT
- USER (1) â”€â”€modifieâ”€â”€â†’ (N) HISTORIQUE_STATUS
```

---

## 2ï¸âƒ£ TABLE : SESSION

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          SESSION                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ğŸ”‘ id                BIGINT           [PK]                   â”‚
â”‚ ğŸ”— user_id           BIGINT           [FK â†’ USER.id, NOT NULL]â”‚
â”‚                                       [ON DELETE CASCADE]     â”‚
â”‚                                                               â”‚
â”‚ âš¡ token              VARCHAR(500)     [UNIQUE, NOT NULL]     â”‚
â”‚    device_info       VARCHAR(255)                            â”‚
â”‚    ip_address        VARCHAR(50)                             â”‚
â”‚                                                               â”‚
â”‚ ğŸ“… created_at        TIMESTAMP        [DEFAULT NOW()]        â”‚
â”‚    expires_at        TIMESTAMP        [NOT NULL]             â”‚
â”‚    is_active         BOOLEAN          [DEFAULT TRUE]         â”‚
â”‚    last_activity_at  TIMESTAMP        [DEFAULT NOW()]        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Relations :
- SESSION (N) â”€â”€appartient Ã â”€â”€â†’ (1) USER
```

---

## 3ï¸âƒ£ TABLE : LOGIN_ATTEMPT

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                       LOGIN_ATTEMPT                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ğŸ”‘ id                BIGINT           [PK]                   â”‚
â”‚                                                               â”‚
â”‚ âš¡ email              VARCHAR(255)     [NOT NULL]             â”‚
â”‚ ğŸ”— user_id           BIGINT           [FK â†’ USER.id]         â”‚
â”‚                                       [ON DELETE SET NULL]    â”‚
â”‚                                                               â”‚
â”‚    success           BOOLEAN          [NOT NULL]             â”‚
â”‚    failure_reason    VARCHAR(50)                             â”‚
â”‚                      â€¢ USER_NOT_FOUND                        â”‚
â”‚                      â€¢ INVALID_PASSWORD                      â”‚
â”‚                      â€¢ ACCOUNT_LOCKED                        â”‚
â”‚                      â€¢ FIREBASE_ERROR                        â”‚
â”‚                                                               â”‚
â”‚    ip_address        VARCHAR(50)                             â”‚
â”‚    user_agent        VARCHAR(255)                            â”‚
â”‚ ğŸ“… attempted_at      TIMESTAMP        [DEFAULT NOW()]        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Contraintes :
- CHECK: (success=TRUE AND failure_reason IS NULL) OR
         (success=FALSE AND failure_reason IS NOT NULL)

Relations :
- LOGIN_ATTEMPT (N) â”€â”€concerneâ”€â”€â†’ (1) USER [nullable]
```

---

## 4ï¸âƒ£ TABLE : FAILED_LOGIN_TRACKING

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  FAILED_LOGIN_TRACKING                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ğŸ”‘ id                BIGINT           [PK]                   â”‚
â”‚ âš¡ email              VARCHAR(255)     [UNIQUE, NOT NULL]     â”‚
â”‚                                                               â”‚
â”‚    failed_count      INT              [DEFAULT 0]            â”‚
â”‚    first_failed_at   TIMESTAMP                               â”‚
â”‚    last_failed_at    TIMESTAMP                               â”‚
â”‚                                                               â”‚
â”‚ ğŸ”’ is_blocked        BOOLEAN          [DEFAULT FALSE]        â”‚
â”‚    blocked_until     TIMESTAMP                               â”‚
â”‚    blocked_reason    VARCHAR(100)                            â”‚
â”‚                                                               â”‚
â”‚ ğŸ”— unblocked_by      BIGINT           [FK â†’ USER.id]         â”‚
â”‚                                       [ON DELETE SET NULL]    â”‚
â”‚    unblocked_at      TIMESTAMP                               â”‚
â”‚                                                               â”‚
â”‚ ğŸ“… created_at        TIMESTAMP        [DEFAULT NOW()]        â”‚
â”‚    updated_at        TIMESTAMP        [DEFAULT NOW()]        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Relations :
- FAILED_LOGIN_TRACKING (N) â”€â”€dÃ©bloquÃ© parâ”€â”€â†’ (1) USER [Manager]
```

---

## 5ï¸âƒ£ TABLE : SIGNALEMENT

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        SIGNALEMENT                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ğŸ”‘ id                    BIGINT           [PK]               â”‚
â”‚ ğŸ”— user_id               BIGINT           [FK â†’ USER.id]     â”‚
â”‚                                           [ON DELETE SET NULL]â”‚
â”‚                                                               â”‚
â”‚ ğŸ”¥ firebase_id           VARCHAR(128)     [UNIQUE]           â”‚
â”‚    firebase_synced       BOOLEAN          [DEFAULT FALSE]    â”‚
â”‚    last_sync_at          TIMESTAMP                           â”‚
â”‚                                                               â”‚
â”‚ ğŸ“ latitude              DECIMAL(10,8)    [NOT NULL]         â”‚
â”‚    longitude             DECIMAL(11,8)    [NOT NULL]         â”‚
â”‚    adresse               VARCHAR(255)                        â”‚
â”‚                                                               â”‚
â”‚    description           TEXT             [NOT NULL]         â”‚
â”‚    photo_url             VARCHAR(500)                        â”‚
â”‚                                                               â”‚
â”‚    status                VARCHAR(20)      [NOT NULL]         â”‚
â”‚                          â€¢ NOUVEAU         [DEFAULT]         â”‚
â”‚                          â€¢ EN_COURS                          â”‚
â”‚                          â€¢ TERMINE                           â”‚
â”‚                                                               â”‚
â”‚ ğŸ’° surface_m2            DECIMAL(10,2)    [â‰¥ 0]             â”‚
â”‚    budget                DECIMAL(15,2)    [â‰¥ 0]             â”‚
â”‚    entreprise            VARCHAR(150)                        â”‚
â”‚                                                               â”‚
â”‚ ğŸ“… date_signalement      TIMESTAMP        [DEFAULT NOW()]    â”‚
â”‚    date_debut_travaux    TIMESTAMP                           â”‚
â”‚    date_fin_travaux      TIMESTAMP                           â”‚
â”‚                                                               â”‚
â”‚    created_at            TIMESTAMP        [DEFAULT NOW()]    â”‚
â”‚    updated_at            TIMESTAMP        [DEFAULT NOW()]    â”‚
â”‚ ğŸ”— last_modified_by      BIGINT           [FK â†’ USER.id]     â”‚
â”‚                                           [ON DELETE SET NULL]â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Contraintes :
- CHECK: status IN ('NOUVEAU', 'EN_COURS', 'TERMINE')
- CHECK: surface_m2 IS NULL OR surface_m2 >= 0
- CHECK: budget IS NULL OR budget >= 0
- CHECK: date_debut_travaux IS NULL OR date_debut_travaux >= date_signalement
- CHECK: date_fin_travaux IS NULL OR date_fin_travaux >= date_debut_travaux

Relations :
- SIGNALEMENT (N) â”€â”€crÃ©Ã© parâ”€â”€â†’ (1) USER
- SIGNALEMENT (N) â”€â”€modifiÃ© parâ”€â”€â†’ (1) USER
- SIGNALEMENT (1) â”€â”€possÃ¨deâ”€â”€â†’ (N) HISTORIQUE_STATUS
```

---

## 6ï¸âƒ£ TABLE : HISTORIQUE_STATUS

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     HISTORIQUE_STATUS                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ğŸ”‘ id                BIGINT           [PK]                   â”‚
â”‚ ğŸ”— signalement_id    BIGINT           [FK â†’ SIGNALEMENT.id]  â”‚
â”‚                                       [ON DELETE CASCADE]     â”‚
â”‚                                                               â”‚
â”‚    ancien_status     VARCHAR(20)      [NOT NULL]             â”‚
â”‚    nouveau_status    VARCHAR(20)      [NOT NULL]             â”‚
â”‚                                                               â”‚
â”‚ ğŸ”— modified_by       BIGINT           [FK â†’ USER.id]         â”‚
â”‚                                       [ON DELETE SET NULL]    â”‚
â”‚                                                               â”‚
â”‚    commentaire       TEXT                                    â”‚
â”‚    metadata          JSONB                                   â”‚
â”‚                                                               â”‚
â”‚ ğŸ“… changed_at        TIMESTAMP        [DEFAULT NOW()]        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Relations :
- HISTORIQUE_STATUS (N) â”€â”€appartient Ã â”€â”€â†’ (1) SIGNALEMENT
- HISTORIQUE_STATUS (N) â”€â”€modifiÃ© parâ”€â”€â†’ (1) USER
```

---

## 7ï¸âƒ£ TABLE : SYNC_QUEUE

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        SYNC_QUEUE                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ğŸ”‘ id                    BIGINT           [PK]               â”‚
â”‚                                                               â”‚
â”‚    entity_type           VARCHAR(50)      [NOT NULL]         â”‚
â”‚                          â€¢ USER                              â”‚
â”‚                          â€¢ SIGNALEMENT                       â”‚
â”‚    entity_id             BIGINT           [NOT NULL]         â”‚
â”‚                                                               â”‚
â”‚ ğŸ”¥ firebase_id           VARCHAR(128)                        â”‚
â”‚                                                               â”‚
â”‚    action                VARCHAR(20)      [NOT NULL]         â”‚
â”‚                          â€¢ CREATE                            â”‚
â”‚                          â€¢ UPDATE                            â”‚
â”‚                          â€¢ DELETE                            â”‚
â”‚                                                               â”‚
â”‚    direction             VARCHAR(20)      [NOT NULL]         â”‚
â”‚                          â€¢ TO_FIREBASE                       â”‚
â”‚                          â€¢ FROM_FIREBASE                     â”‚
â”‚                                                               â”‚
â”‚    status                VARCHAR(20)      [NOT NULL]         â”‚
â”‚                          â€¢ PENDING         [DEFAULT]         â”‚
â”‚                          â€¢ PROCESSING                        â”‚
â”‚                          â€¢ SUCCESS                           â”‚
â”‚                          â€¢ FAILED                            â”‚
â”‚                                                               â”‚
â”‚    error_message         TEXT                                â”‚
â”‚    retry_count           INT              [DEFAULT 0]        â”‚
â”‚    max_retries           INT              [DEFAULT 3]        â”‚
â”‚                                                               â”‚
â”‚    data_snapshot         JSONB                               â”‚
â”‚                                                               â”‚
â”‚ ğŸ”— synced_by             BIGINT           [FK â†’ USER.id]     â”‚
â”‚                                           [ON DELETE SET NULL]â”‚
â”‚    priority              INT              [DEFAULT 5]        â”‚
â”‚                                                               â”‚
â”‚ ğŸ“… created_at            TIMESTAMP        [DEFAULT NOW()]    â”‚
â”‚    scheduled_at          TIMESTAMP        [DEFAULT NOW()]    â”‚
â”‚    processing_started_at TIMESTAMP                           â”‚
â”‚    processed_at          TIMESTAMP                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Contraintes :
- CHECK: entity_type IN ('USER', 'SIGNALEMENT')
- CHECK: action IN ('CREATE', 'UPDATE', 'DELETE')
- CHECK: direction IN ('TO_FIREBASE', 'FROM_FIREBASE')
- CHECK: status IN ('PENDING', 'PROCESSING', 'SUCCESS', 'FAILED')

Relations :
- SYNC_QUEUE (N) â”€â”€dÃ©clenchÃ©e parâ”€â”€â†’ (1) USER
```

---

## 8ï¸âƒ£ TABLE : SYNC_HISTORY

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                       SYNC_HISTORY                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ğŸ”‘ id                BIGINT           [PK]                   â”‚
â”‚ ğŸ”— sync_queue_id     BIGINT                                  â”‚
â”‚                                                               â”‚
â”‚    entity_type       VARCHAR(50)      [NOT NULL]             â”‚
â”‚                      â€¢ USER                                  â”‚
â”‚                      â€¢ SIGNALEMENT                           â”‚
â”‚    entity_id         BIGINT           [NOT NULL]             â”‚
â”‚                                                               â”‚
â”‚    action            VARCHAR(20)      [NOT NULL]             â”‚
â”‚                      â€¢ CREATE                                â”‚
â”‚                      â€¢ UPDATE                                â”‚
â”‚                      â€¢ DELETE                                â”‚
â”‚                                                               â”‚
â”‚    direction         VARCHAR(20)      [NOT NULL]             â”‚
â”‚                      â€¢ TO_FIREBASE                           â”‚
â”‚                      â€¢ FROM_FIREBASE                         â”‚
â”‚                                                               â”‚
â”‚    status            VARCHAR(20)      [NOT NULL]             â”‚
â”‚                      â€¢ SUCCESS                               â”‚
â”‚                      â€¢ FAILED                                â”‚
â”‚                                                               â”‚
â”‚    error_message     TEXT                                    â”‚
â”‚    firebase_response JSONB                                   â”‚
â”‚    duration_ms       INT                                     â”‚
â”‚                                                               â”‚
â”‚ ğŸ”— synced_by         BIGINT           [FK â†’ USER.id]         â”‚
â”‚                                       [ON DELETE SET NULL]    â”‚
â”‚                                                               â”‚
â”‚ ğŸ“… synced_at         TIMESTAMP        [DEFAULT NOW()]        â”‚
â”‚    created_at        TIMESTAMP        [DEFAULT NOW()]        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Contraintes :
- CHECK: entity_type IN ('USER', 'SIGNALEMENT')
- CHECK: action IN ('CREATE', 'UPDATE', 'DELETE')
- CHECK: direction IN ('TO_FIREBASE', 'FROM_FIREBASE')
- CHECK: status IN ('SUCCESS', 'FAILED')

Relations :
- SYNC_HISTORY (N) â”€â”€rÃ©fÃ©renceâ”€â”€â†’ (1) SYNC_QUEUE [nullable]
- SYNC_HISTORY (N) â”€â”€dÃ©clenchÃ©e parâ”€â”€â†’ (1) USER
```

---

## ğŸ”— RÃ‰SUMÃ‰ DES RELATIONS

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    MATRICE DES RELATIONS                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                              â”‚
â”‚  USER (1) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’ (N) USER                              â”‚
â”‚    Relation : created_by (self-reference)                   â”‚
â”‚    Manager crÃ©e des utilisateurs                            â”‚
â”‚                                                              â”‚
â”‚  USER (1) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’ (N) SESSION                           â”‚
â”‚    Un utilisateur a plusieurs sessions                      â”‚
â”‚    ON DELETE CASCADE                                        â”‚
â”‚                                                              â”‚
â”‚  USER (1) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’ (N) LOGIN_ATTEMPT                     â”‚
â”‚    Un utilisateur a plusieurs tentatives                    â”‚
â”‚    user_id peut Ãªtre NULL (email inexistant)                â”‚
â”‚                                                              â”‚
â”‚  USER (1) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’ (N) FAILED_LOGIN_TRACKING             â”‚
â”‚    Manager dÃ©bloque des comptes (unblocked_by)              â”‚
â”‚                                                              â”‚
â”‚  USER (1) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’ (N) SIGNALEMENT                       â”‚
â”‚    Un utilisateur crÃ©e plusieurs signalements               â”‚
â”‚    Relation via user_id et last_modified_by                 â”‚
â”‚                                                              â”‚
â”‚  USER (1) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’ (N) HISTORIQUE_STATUS                 â”‚
â”‚    Un manager modifie plusieurs statuts                     â”‚
â”‚    Relation via modified_by                                 â”‚
â”‚                                                              â”‚
â”‚  USER (1) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’ (N) SYNC_QUEUE                        â”‚
â”‚    Un utilisateur dÃ©clenche des syncs                       â”‚
â”‚    Relation via synced_by                                   â”‚
â”‚                                                              â”‚
â”‚  USER (1) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’ (N) SYNC_HISTORY                      â”‚
â”‚    Un utilisateur a un historique de syncs                  â”‚
â”‚    Relation via synced_by                                   â”‚
â”‚                                                              â”‚
â”‚  SIGNALEMENT (1) â”€â”€â”€â†’ (N) HISTORIQUE_STATUS                 â”‚
â”‚    Un signalement a plusieurs changements de statut         â”‚
â”‚    ON DELETE CASCADE                                        â”‚
â”‚                                                              â”‚
â”‚  SYNC_QUEUE (1) â”€â”€â”€â”€â†’ (N) SYNC_HISTORY                      â”‚
â”‚    Une entrÃ©e queue a plusieurs entrÃ©es historique          â”‚
â”‚    sync_queue_id peut Ãªtre NULL                             â”‚
â”‚                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“Š LÃ‰GENDE

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         LÃ‰GENDE                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                              â”‚
â”‚  ğŸ”‘  ClÃ© Primaire (Primary Key)                             â”‚
â”‚  ğŸ”—  ClÃ© Ã‰trangÃ¨re (Foreign Key)                            â”‚
â”‚  âš¡  ClÃ© Unique (Unique)                                     â”‚
â”‚  ğŸ”¥  LiÃ© Ã  Firebase                                         â”‚
â”‚  ğŸ”’  SÃ©curitÃ© / Blocage                                     â”‚
â”‚  ğŸ’°  Informations budgÃ©taires                               â”‚
â”‚  ğŸ“  GÃ©olocalisation                                        â”‚
â”‚  ğŸ“…  Date / Timestamp                                       â”‚
â”‚                                                              â”‚
â”‚  [PK]           Primary Key                                 â”‚
â”‚  [FK]           Foreign Key                                 â”‚
â”‚  [UNIQUE]       Contrainte d'unicitÃ©                        â”‚
â”‚  [NOT NULL]     Champ obligatoire                           â”‚
â”‚  [DEFAULT x]    Valeur par dÃ©faut                           â”‚
â”‚  [â‰¥ 0]          Valeur positive ou nulle                    â”‚
â”‚                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## âœ… VALIDATION COMPLÃˆTE

**8 tables dÃ©finies avec :**
- âœ… Tous les attributs avec types et contraintes
- âœ… Toutes les clÃ©s primaires et Ã©trangÃ¨res
- âœ… Toutes les contraintes CHECK
- âœ… Toutes les relations avec cardinalitÃ©s
- âœ… Toutes les valeurs d'Ã©numÃ©ration possibles
- âœ… Actions ON DELETE spÃ©cifiÃ©es

**MCD prÃªt pour implÃ©mentation ! ğŸš€**